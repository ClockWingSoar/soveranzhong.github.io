---
layout: post
title: Detail explaination of /etc/login.defs
categories: [Linux, configuration]
description: 关于/etc/login.defs文件的详细介绍
keywords: linux, login.defs, configuration
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
---

# 关于Centos8和ubuntu24中的login.defs的解释和不同
## Centos 8
以下是CentOS8中 `/etc/login.defs` 文件中各配置项的详细解释：

---

### **1. 邮件目录配置**
```bash
MAIL_DIR        /var/spool/mail
```
- **作用**：定义用户邮箱的存储目录。默认情况下，用户的邮件会存放在 `/var/spool/mail/用户名` 中。
- **注意**：如果同时定义了 `MAIL_DIR` 和 `MAIL_FILE`，`MAIL_DIR` 优先级更高。

---

### **2. 密码策略**
```bash
PASS_MAX_DAYS   99999  # 密码最长使用天数
PASS_MIN_DAYS   0      # 密码修改最短间隔天数
PASS_MIN_LEN    5      # 密码最小长度
PASS_WARN_AGE   7      # 密码过期前警告天数
```
- **`PASS_MAX_DAYS`**：密码的最长有效期（默认 99999 天，表示几乎永不过期）。
- **`PASS_MIN_DAYS`**：密码修改后，允许再次修改的最小间隔天数（0 表示随时可修改）。
- **`PASS_MIN_LEN`**：密码的最小长度（需结合 PAM 模块生效）。
- **`PASS_WARN_AGE`**：密码过期前多少天开始警告用户。

---

### **3. 用户和组 ID 范围**
```bash
UID_MIN         1000  # 普通用户的最小 UID
UID_MAX        60000  # 普通用户的最大 UID
SYS_UID_MIN     201   # 系统账户的最小 UID
SYS_UID_MAX     999   # 系统账户的最大 UID

GID_MIN         1000  # 普通组的最小 GID
GID_MAX        60000  # 普通组的最大 GID
SYS_GID_MIN     201   # 系统组的最小 GID
SYS_GID_MAX     999   # 系统组的最大 GID
```
- **普通用户/组**：UID/GID 范围通常从 1000 开始，避免与系统账户冲突。
- **系统账户/组**：UID/GID 范围较小（如 201-999），用于运行系统服务。

---

### **4. 用户删除时的行为**
```bash
USERDEL_CMD    /usr/sbin/userdel_local
```
- **作用**：删除用户时执行的额外命令（如清理用户的定时任务、打印任务等）。
- **默认**：通常未定义，需手动配置。

---

### **5. 家目录配置**
```bash
CREATE_HOME     yes  # 是否默认创建用户家目录
UMASK           077  # 家目录的默认权限掩码
```
- **`CREATE_HOME`**：`useradd` 是否自动创建用户家目录（`yes` 为默认）。
- **`UMASK`**：家目录的权限掩码（`077` 表示权限为 `700`，即仅用户可读写执行）。

---

### **6. 用户组管理**
```bash
USERGROUPS_ENAB yes  # 是否删除无成员的私有组
```
- **作用**：启用后，`userdel` 会删除用户的主组（如果该组没有其他成员）。

---

### **7. 密码加密方法**
```bash
ENCRYPT_METHOD SHA512  # 密码加密算法
```
- **作用**：指定用户密码的加密算法（`SHA512` 是当前推荐的安全算法）。

---

### **总结**
- **核心功能**：`/etc/login.defs` 是 `shadow-utils` 工具的全局配置文件，用于定义用户和组的默认行为。
- **优先级**：命令行参数（如 `useradd -m`）会覆盖此文件的配置。
- **与 PAM 的关系**：密码复杂度等策略需结合 PAM 模块（如 `/etc/pam.d/system-auth`）生效。

## ubuntu24
以下是 Ubuntu 24.04 的 `/etc/login.defs` 文件内容的详细解释，以及与 CentOS 8 的主要区别：

---

### **1. 邮件目录配置**
```bash
MAIL_DIR        /var/mail
```
- **作用**：定义用户邮箱的存储目录（Ubuntu 使用 `/var/mail`，而 CentOS 使用 `/var/spool/mail`）。
- **区别**：
  - CentOS 默认路径为 `/var/spool/mail`。
  - Ubuntu 默认路径为 `/var/mail`。

---

### **2. 登录日志与安全**
```bash
FAILLOG_ENAB            yes  # 启用登录失败记录
LOG_UNKFAIL_ENAB        no   # 禁用记录未知用户名的登录失败
LOG_OK_LOGINS           no   # 禁用记录成功登录
SYSLOG_SU_ENAB          yes  # 启用 `su` 的 syslog 记录
SYSLOG_SG_ENAB          yes  # 启用 `newgrp` 和 `sg` 的 syslog 记录
```
- **区别**：
  - CentOS 未显式配置这些选项，默认行为可能不同。
  - Ubuntu 更详细地控制了登录日志的行为。

---

### **3. 终端权限**
```bash
TTYGROUP        tty     # 终端设备所属组
TTYPERM         0600    # 终端设备权限（仅用户可读写）
```
- **区别**：
  - CentOS 默认权限为 `0620`（组可写），Ubuntu 为 `0600`（更严格）。

---

### **4. 用户和组 ID 范围**
```bash
UID_MIN         1000    # 普通用户最小 UID
UID_MAX        60000    # 普通用户最大 UID
SUB_UID_MIN    100000   # 用户子 UID 范围（用于容器）
SUB_UID_MAX  600100000  # 用户子 UID 最大值
SUB_UID_COUNT   65536   # 每个用户的子 UID 数量
```
- **区别**：
  - CentOS 未定义 `SUB_UID_*` 相关配置，Ubuntu 明确支持用户子 UID（用于容器化场景）。

---

### **5. 密码策略**
```bash
PASS_MAX_DAYS   99999  # 密码最长有效期
PASS_MIN_DAYS   0      # 密码修改最短间隔
PASS_WARN_AGE   7      # 密码过期前警告天数
```
- **区别**：
  - 与 CentOS 相同，但 CentOS 额外定义了 `PASS_MIN_LEN`（密码最小长度），Ubuntu 未在此文件中定义。

---

### **6. 家目录与权限**
```bash
UMASK           022     # 默认权限掩码
HOME_MODE       0750    # 家目录默认权限
```
- **区别**：
  - CentOS 默认 `UMASK` 为 `077`，Ubuntu 为 `022`（更宽松）。
  - Ubuntu 显式定义了 `HOME_MODE`（家目录权限），CentOS 未定义。

---

### **7. 用户组管理**
```bash
USERGROUPS_ENAB yes  # 启用用户私有组
```
- **区别**：
  - 与 CentOS 相同，但 CentOS 的 `USERGROUPS_ENAB` 会修改 `UMASK` 行为（如 `022` → `002`），Ubuntu 未提及此细节。

---

### **8. 密码加密方法**
```bash
ENCRYPT_METHOD SHA512  # 密码加密算法
```
- **区别**：
  - 与 CentOS 相同，均推荐 `SHA512`。

---

### **9. 其他特性**
- **Ubuntu 特有配置**：
  - `SUB_UID_*` 和 `SUB_GID_*`：支持用户子 UID/GID（用于容器和嵌套用户空间）。
  - `NONEXISTENT /nonexistent`：标记无家目录的系统账户。
  - `HMAC_CRYPTO_ALGO SHA512`：指定 HMAC 算法（用于 PAM 模块）。
- **CentOS 特有配置**：
  - `PASS_MIN_LEN`：密码最小长度。
  - `USERDEL_CMD`：自定义用户删除命令。

---

### **10. 废弃配置**
```bash
################# OBSOLETED BY PAM ##############
```
- **说明**：
  - Ubuntu 明确标记了被 PAM 模块替代的旧配置（如 `MOTD_FILE`、`FAIL_DELAY` 等），而 CentOS 未显式标注。

---

### **总结**

| **特性**               | **Ubuntu 24.04**                          | **CentOS 8**                              |
|------------------------|------------------------------------------|------------------------------------------|
| **邮件目录**           | `/var/mail`                             | `/var/spool/mail`                        |
| **终端权限**           | `0600`（严格）                          | `0620`（组可写）                         |
| **子 UID/GID 支持**    | 是（用于容器）                          | 否                                       |
| **默认 UMASK**         | `022`                                   | `077`                                    |
| **密码最小长度**       | 未定义                                  | 定义（`PASS_MIN_LEN`）                   |
| **PAM 替代标记**       | 显式标注废弃配置                        | 未标注                                   |

